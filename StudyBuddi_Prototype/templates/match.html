<html>
  <head>
    <title>Study Buddy - Matching</title>
    <!--needed meta characteristics-->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Bootstrap CSS find way to change color/organiation-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />

    <style>
      .members_wrapper {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Ensures members are side by side and centered */
        width: 100%;
      }

      .profile_img {
        width: 14rem; /* Fixed width */
        height: 14rem; /* Fixed height */
        object-fit: cover; /* Ensures image covers the area without stretching */
        border-radius: 1rem;
      }

      .contact_group_button {
        width: auto;
        padding: 10px 20px;
        margin-top: 10px;
      }
      /*  Below this is what eva had in the style.css*/
      .header {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: #f1f1f1;
        text-align: center;
        padding: 5px;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        z-index: 10;
      }

      .header button {
        color: black;
        padding: 7px 10px;
        margin: 8px 0;
        border: 1px solid black;
        border-radius: 4px;
        cursor: pointer;
        width: 120px;
      }

      .main_content {
        border: 1px solid grey;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        margin: 7%;
        background-color: white;
      }

      .selections {
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
      }

      .filter-options {
        margin-left: 20px;
      }

      .group_container {
        width: 100%;
        left: 5%;
        margin-top: 20px;
        border: 1px solid grey;
        border-radius: 8px;
        margin-bottom: 1.2rem;
        background-color: rgb(243, 234, 243);
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        padding: 1rem;
        justify-content: space-evenly;
        align-items: center;
      }
      .member_container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        border: 1px solid grey;
        margin: 1rem 1rem 1rem 1rem;
        padding: 0.2rem;
        border-radius: 1rem;
        background-color: white;
        text-wrap: wrap;
        width: 18rem; /* Set the fixed width */
      }

      #groups {
        align-content: center;
        width: 100%;
      }
      .tags {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      .tags_tags {
        border: 0.1rem solid black;
        border-radius: 1rem;
        padding: 0 0.5rem;
        margin: 0.5rem 0.2rem;
      }
      button {
        width: 10rem;
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        background-color: var(--primary-color);
        border-radius: 1rem;
        margin: auto;
        text-align: center;
        margin-bottom: 1em;
      }
      .bio-p {
        margin: 0.5rem;
      }
      .company_name {
        margin-right: 50%;
      }

      button:hover {
        background-color: #ddd;
      }
      button:active {
        background-color: #000;
        color: white;
      }

      .selections {
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
      }
      .filter-options {
        margin-left: 20px;
      }
      .group_container {
        width: 100%;
        left: 5%;
        margin-top: 20px;
        border: 1px solid grey;
        border-radius: 8px;
      }

      .head {
        text-align: center;
        padding-top: 10px;
        font-size: 200%;
        font-family: Cambria, Cochin, Georgia, Times, "Times New Roman", serif;
        color: #000;
      }
      body {
        background-color: #d4c4deb0;
      }
      main {
        margin-top: 5rem;
      }
      .flex-r {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        margin-top: 8rem;
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        z-index: 9999; /* Ensure it's above other content */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .expanded_profile {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .expanded_profile .profile_img {
        width: 20rem;
        height: 20rem;
        object-fit: cover;
        border-radius: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1 class="company_name">StudyBuddi</h1>
      <button onclick="location.href='/'">Home</button>
      <button onclick="location.href='updateProfile'">Profile</button>
      <button onclick="initializeContent()">Refresh</button>
    </div>
    <div class="main_content">
      <div class="selections">
        <div>
          Group size:
          <select id="groupSize">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <!-- Add more options as needed -->
          </select>
        </div>
        <div class="filter-options">
          Filter by:
          <br />
          <label
            ><input type="checkbox" name="filter" value="sameClass" />Same
            class</label
          >
          <label
            ><input type="checkbox" name="filter" value="sameStudyType" />Same
            study type</label
          >
          <label
            ><input type="checkbox" name="filter" value="sameTime" />Same
            preferred time</label
          >
          <!-- Add more options as needed -->
        </div>
      </div>
      <div id="groups">
        <!-- Groups will be dynamically inserted here -->
      </div>
    </div>
  </body>
  <script>
    "use strict";

    let currentUsername = "{{ username }}";

    // Convert server-side data to JSON and parse it in JavaScript
    const rawData = '{{ allUsers | tojson | safe }}';
    const allPeople = JSON.parse(rawData);
    const people = allPeople.filter(
      (person) => person.username !== currentUsername
    );
    console.log(currentUsername);
    for (let i = 0; i < allPeople.length; i++) {
      console.log(allPeople[i].name);
    }

    function initializeContent() {
      const groupSize = parseInt(
        document.getElementById("groupSize").value,
        10
      );
      const groupsContainer = document.getElementById("groups");
      groupsContainer.innerHTML = ""; // Clear previous groups

      for (let i = 0; i < people.length; i += groupSize) {
        const groupMembers = people.slice(i, i + groupSize);
        let membersHTML = groupMembers
          .map(
            (member) => `
                <div class="member_container">
                    <h2>${member.name}</h2>
                    <img class="profile_img" src="data:image/jpeg;base64,${member.img}" alt="Profile image">
                    <div class='tags'>${member.class1}</div>
                    <p class='bio-p'>${member.bio}</p>
                </div>
            `
          )

          .join("");

        let emails = groupMembers.map((member) => member.email).join(",");
        groupsContainer.innerHTML += `<div class="group_container"><div class="members_wrapper">${membersHTML}</div><button class="contact_group_button" onclick="window.location.href='mailto:${emails}'">Contact Group</button></div>`;
        const profileCards = document.querySelectorAll(".member_container");
        profileCards.forEach((card) =>
          card.addEventListener("click", showCard)
        );
      }
    }

    document.addEventListener("DOMContentLoaded", initializeContent);
    document
      .getElementById("groupSize")
      .addEventListener("change", initializeContent);
    function showCard(e) {
      // Get the clicked member container
      const memberContainer = e.target.closest(".member_container");

      // Create a new element for overlay
      const overlay = document.createElement("div");
      overlay.classList.add("overlay");

      // Create HTML content for the expanded profile
      const expandedProfileHTML = `
    <div class="expanded_profile">
      ${memberContainer.innerHTML}
    </div>
  `;

      // Set the HTML content to the overlay
      overlay.innerHTML = expandedProfileHTML;

      // Append the overlay to the body
      document.body.appendChild(overlay);

      // Add a click event listener to the overlay to close it when clicked
      overlay.addEventListener("click", function () {
        overlay.remove();
      });
    }
  </script>
</html>
